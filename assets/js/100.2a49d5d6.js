(window.webpackJsonp=window.webpackJsonp||[]).push([[100],{432:function(t,e,s){"use strict";s.r(e);var o=s(5),a=Object(o.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"health-monitor"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#health-monitor"}},[t._v("#")]),t._v(" Health monitor")]),t._v(" "),e("p",[t._v("The health monitor requires both "),e("code",[t._v("sanic>=22.9")]),t._v(" and "),e("code",[t._v("sanic-ext>=22.9")]),t._v(".")]),t._v(" "),e("p",[t._v("You can setup Sanic Extensions to monitor the health of your worker processes. This requires that you not be in "),e("RouterLink",{attrs:{to:"/en/guide/deployment/manager.html#single-process-mode"}},[t._v("single process mode")]),t._v(".")],1),t._v(" "),e("h2",{attrs:{id:"setup"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setup"}},[t._v("#")]),t._v(" Setup")]),t._v(" "),e("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("p",[t._v("Out of the box, the health monitor is disabled. You will need to opt-in if you would like to use it.")])]),t._v(" "),e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[t._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HEALTH "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n")])])])])]),t._v(" "),e("h2",{attrs:{id:"how-does-it-work"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#how-does-it-work"}},[t._v("#")]),t._v(" How does it work")]),t._v(" "),e("p",[t._v("The monitor sets up a new background process that will periodically receive acknowledgements of liveliness from each worker process. If a worker process misses a report too many times, then the monitor will restart that one worker.")]),t._v(" "),e("h2",{attrs:{id:"diagnostics-endpoint"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#diagnostics-endpoint"}},[t._v("#")]),t._v(" Diagnostics endpoint")]),t._v(" "),e("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("p",[t._v("The health monitor will also enable a diagnostics endpoint that outputs the "),e("RouterLink",{attrs:{to:"/en/guide/deployment/manager.html#worker-state"}},[t._v("worker state")]),t._v(". By default is id disabled.")],1),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[t._v("The diagnostics endpoint is not secured. If you are deploying it in a production environment, you should take steps to protect it with a proxy server if you are using one. If not, you may want to consider disabling this feature in production since it will leak details about your server state.")])])]),t._v(" "),e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ curl http://localhost:8000/__health__\n{\n    'Sanic-Main': {'pid': 99997},\n    'Sanic-Server-0-0': {\n        'server': True,\n        'state': 'ACKED',\n        'pid': 9999,\n        'start_at': datetime.datetime(2022, 10, 1, 0, 0, 0, 0, tzinfo=datetime.timezone.utc),\n        'starts': 2,\n        'restart_at': datetime.datetime(2022, 10, 1, 0, 0, 12, 861332, tzinfo=datetime.timezone.utc)\n    },\n    'Sanic-Reloader-0': {\n        'server': False,\n        'state': 'STARTED',\n        'pid': 99998,\n        'start_at': datetime.datetime(2022, 10, 1, 0, 0, 0, 0, tzinfo=datetime.timezone.utc),\n        'starts': 1\n    }\n}\n")])])])])]),t._v(" "),e("h2",{attrs:{id:"configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[t._v("#")]),t._v(" Configuration")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Key")]),t._v(" "),e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Default")]),t._v(" "),e("th",[t._v("Description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("HEALTH")]),t._v(" "),e("td",[e("code",[t._v("bool")])]),t._v(" "),e("td",[e("code",[t._v("False")])]),t._v(" "),e("td",[t._v("Whether to enable this extension.")])]),t._v(" "),e("tr",[e("td",[t._v("HEALTH_ENDPOINT")]),t._v(" "),e("td",[e("code",[t._v("bool")])]),t._v(" "),e("td",[e("code",[t._v("False")])]),t._v(" "),e("td",[t._v("Whether to enable the diagnostics endpoint.")])]),t._v(" "),e("tr",[e("td",[t._v("HEALTH_MAX_MISSES")]),t._v(" "),e("td",[e("code",[t._v("int")])]),t._v(" "),e("td",[e("code",[t._v("3")])]),t._v(" "),e("td",[t._v("The number of consecutive misses before a worker process is restarted.")])]),t._v(" "),e("tr",[e("td",[t._v("HEALTH_MISSED_THRESHHOLD")]),t._v(" "),e("td",[e("code",[t._v("int")])]),t._v(" "),e("td",[e("code",[t._v("10")])]),t._v(" "),e("td",[t._v("The number of seconds the monitor checks for worker process health.")])]),t._v(" "),e("tr",[e("td",[t._v("HEALTH_MONITOR")]),t._v(" "),e("td",[e("code",[t._v("bool")])]),t._v(" "),e("td",[e("code",[t._v("True")])]),t._v(" "),e("td",[t._v("Whether to enable the health monitor.")])]),t._v(" "),e("tr",[e("td",[t._v("HEALTH_REPORT_INTERVAL")]),t._v(" "),e("td",[e("code",[t._v("int")])]),t._v(" "),e("td",[e("code",[t._v("5")])]),t._v(" "),e("td",[t._v("The number of seconds between reporting each acknowledgement of liveliness.")])]),t._v(" "),e("tr",[e("td",[t._v("HEALTH_URI_TO_INFO")]),t._v(" "),e("td",[e("code",[t._v("str")])]),t._v(" "),e("td",[e("code",[t._v('""')])]),t._v(" "),e("td",[t._v("The URI path of the diagnostics endpoint.")])]),t._v(" "),e("tr",[e("td",[t._v("HEALTH_URL_PREFIX")]),t._v(" "),e("td",[e("code",[t._v("str")])]),t._v(" "),e("td",[e("code",[t._v('"/__health__"')])]),t._v(" "),e("td",[t._v("The URI prefix of the diagnostics blueprint.")])])])])])}),[],!1,null,null,null);e.default=a.exports}}]);