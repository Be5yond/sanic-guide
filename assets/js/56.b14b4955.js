(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{387:function(t,s,a){"use strict";a.r(s);var e=a(5),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"inspector"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#inspector"}},[t._v("#")]),t._v(" Inspector")]),t._v(" "),s("p",[t._v("The Sanic Inspector is a feature of Sanic Server. It is "),s("em",[t._v("only")]),t._v(" available when running Sanic with the built-in "),s("RouterLink",{attrs:{to:"/en/guide/deployment/manager.html"}},[t._v("worker manager")]),t._v(".")],1),t._v(" "),s("p",[t._v("It is an HTTP application that "),s("em",[t._v("optionally")]),t._v(" runs in the background of your application to allow you to interact with the running instance of your application.")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("INFO")]),t._v(" "),s("p",[t._v("The Inspector was introduced in limited capacity in v22.9, but the documentation on this page assumes you are using v22.12 or higher.")])]),t._v(" "),s("h2",{attrs:{id:"getting-started"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#getting-started"}},[t._v("#")]),t._v(" Getting Started")]),t._v(" "),s("p",[t._v("The inspector is disabled by default. To enable it, you have two options.")]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("Set a flag when creating your application instance.")])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Sanic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TestApp"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" inspector"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("Or, set a configuration value.")])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Sanic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TestApp"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("INSPECTOR "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n")])])])])]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("If you are using the configuration value, it "),s("em",[t._v("must")]),t._v(" be done early and before the main worker process starts. This means that it should either be an environment variable, or it should be set shortly after creating the application instance as shown above.")])]),t._v(" "),s("h2",{attrs:{id:"using-the-inspector"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#using-the-inspector"}},[t._v("#")]),t._v(" Using the Inspector")]),t._v(" "),s("p",[t._v("Once the inspector is running, you will have access to it via the CLI or by directly accessing its web API via HTTP.")]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[s("strong",[t._v("Via CLI")])]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("sanic inspect\n")])])])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[s("strong",[t._v("Via HTTP")])]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" http://localhost:6457\n")])])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("Remember, the Inspector is not running on your Sanic application. It is a seperate process, with a seperate application, and exposed on a seperate socket.")])]),t._v(" "),s("h2",{attrs:{id:"built-in-commands"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#built-in-commands"}},[t._v("#")]),t._v(" Built-in Commands")]),t._v(" "),s("p",[t._v("The Inspector comes with the following built-in commands.")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("CLI Command")]),t._v(" "),s("th",[t._v("HTTP Action")]),t._v(" "),s("th",[t._v("Description")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("inspect")])]),t._v(" "),s("td",[s("code",[t._v("GET /")])]),t._v(" "),s("td",[t._v("Display basic details about the running application.")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("inspect reload")])]),t._v(" "),s("td",[s("code",[t._v("POST /reload")])]),t._v(" "),s("td",[t._v("Trigger a reload of all server workers.")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("inspect shutdown")])]),t._v(" "),s("td",[s("code",[t._v("POST /shutdown")])]),t._v(" "),s("td",[t._v("Trigger a shutdown of all processes.")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("inspect scale N")])]),t._v(" "),s("td",[s("code",[t._v("POST /scale")]),s("br"),s("code",[t._v('{"replicas": N}')])]),t._v(" "),s("td",[t._v("Scale the number of workers. Where "),s("code",[t._v("N")]),t._v(" is the target number of replicas.")])])])]),t._v(" "),s("h2",{attrs:{id:"custom-commands"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#custom-commands"}},[t._v("#")]),t._v(" Custom Commands")]),t._v(" "),s("p",[t._v("The Inspector is easily extendable to add custom commands (and endpoints).")]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("Subclass the "),s("code",[t._v("Inspector")]),t._v(" class and create arbitrary methods. As long as the method name is not preceded by an underscore ("),s("code",[t._v("_")]),t._v("), then the name of the method will be a new subcommand on the inspector.")])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sanic "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" json\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sanic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("worker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("inspector "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Inspector\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyInspector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Inspector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("something")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),t._v("kwargs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("kwargs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\napp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Sanic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TestApp"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" inspector_class"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("MyInspector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" inspector"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),s("p",[t._v("This will expose custom methods in the general pattern:")]),t._v(" "),s("ul",[s("li",[t._v("CLI: "),s("code",[t._v("sanic inspect <method_name>")])]),t._v(" "),s("li",[t._v("HTTP: "),s("code",[t._v("POST /<method_name>")])])]),t._v(" "),s("p",[t._v("It is important to note that the arguments that the new method accepts are derived from how you intend to use the command. For example, the above "),s("code",[t._v("something")]),t._v(" method accepts all positional and keyword based parameters.")]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("In the CLI, the positional and keyword parameters are passed as either positional or keyword arguments to your method. All values will be a "),s("code",[t._v("str")]),t._v(" with the following exceptions:")]),t._v(" "),s("ul",[s("li",[t._v("A keyword parameter with no assigned value will be: "),s("code",[t._v("True")])]),t._v(" "),s("li",[t._v("Unless the parameter is prefixed with "),s("code",[t._v("no-")]),t._v(", then it will be: "),s("code",[t._v("False")])])])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("sanic inspect something one two three "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--four")]),t._v(" --no-five "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--six")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("\n")])])]),s("p",[t._v("In your application log console, you will see:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("('one', 'two', 'three')\n{'four': True, 'five': False, 'six': '6'}\n")])])])])]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("The same can be achieved by hitting the API directly. You can pass arguments to the method by exposing them in a JSON payload. The only thing to note is that the positional arguments should be exposed as "),s("code",[t._v('{"args": [...]}')]),t._v(".")])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" http://localhost:6457/something "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--json")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"args":["one", "two", "three"], "four":true, "five":false, "six":6}\'')]),t._v("\n")])])]),s("p",[t._v("In your application log console, you will see:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("('one', 'two', 'three')\n{'four': True, 'five': False, 'six': 6}\n")])])])])]),t._v(" "),s("h2",{attrs:{id:"using-in-production"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#using-in-production"}},[t._v("#")]),t._v(" Using in production")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("Before exposing the Inspector on a product, please consider all of the options in this section carefully.")])]),t._v(" "),s("p",[t._v("When running Inspector on a remote production instance, you can protect the endpoints by requiring TLS encryption, and requiring API key authentication.")]),t._v(" "),s("h3",{attrs:{id:"tls-encryption"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tls-encryption"}},[t._v("#")]),t._v(" TLS encryption")]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("To the Inspector HTTP instance over TLS, pass the paths to your certificate and key.")])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("INSPECTOR_TLS_CERT "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/cert.pem"')]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("INSPECTOR_TLS_KEY "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/key.pem"')]),t._v("\n")])])])])]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("This will require use of the "),s("code",[t._v("--secure")]),t._v(" flag, or "),s("code",[t._v("https://")]),t._v(".")])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("sanic insect "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--secure")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--host")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("somewhere"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" https://"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("somewhere"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":6457\n")])])])])]),t._v(" "),s("h3",{attrs:{id:"api-key-authentication"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api-key-authentication"}},[t._v("#")]),t._v(" API Key Authentication")]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("You can secure the API with bearer token authentication.")])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("INSPECTOR_API_KEY "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Super-Secret-200"')]),t._v("\n")])])])])]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("This will require the "),s("code",[t._v("--api-key")]),t._v(" parameter, or bearer token authorization header.")])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("sanic inspect --api-key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Super-Secret-200\n")])])]),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" http://localhost:6457  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Authorization: Bearer Super-Secret-200"')]),t._v("\n")])])])])]),t._v(" "),s("h2",{attrs:{id:"configuration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[t._v("#")]),t._v(" Configuration")]),t._v(" "),s("p",[t._v("See "),s("RouterLink",{attrs:{to:"/en/guide/deployment/configuration.html"}},[t._v("configuration")])],1)])}),[],!1,null,null,null);s.default=n.exports}}]);