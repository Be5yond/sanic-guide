(window.webpackJsonp=window.webpackJsonp||[]).push([[113],{435:function(t,e,s){"use strict";s.r(e);var a=s(4),n=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"test-clients"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#test-clients"}},[t._v("#")]),t._v(" Test Clients")]),t._v(" "),e("p",[t._v("There are three different test clients available to you, each of them presents different capabilities.")]),t._v(" "),e("h2",{attrs:{id:"regular-sync-client-sanictestclient"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#regular-sync-client-sanictestclient"}},[t._v("#")]),t._v(" Regular sync client: "),e("code",[t._v("SanicTestClient")])]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("SanicTestClient")]),t._v(" runs an actual version of the Sanic Server on your local network to run its tests. Each time it calls an endpoint it will spin up a version of the application and bind it to a socket on the host OS. Then, it will use "),e("code",[t._v("httpx")]),t._v(" to make calls directly to that application.")]),t._v(" "),e("p",[t._v("This is the typical way that Sanic applications are tested.")]),t._v(" "),e("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("p",[t._v("Once installing Sanic Testing, the regular "),e("code",[t._v("SanicTestClient")]),t._v(" can be used without further setup. This is because Sanic does the leg work for you under the hood.")])]),t._v(" "),e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[t._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test_client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/endpoint"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),e("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("p",[t._v("However, you may find it desirable to instantiate the client yourself.")])]),t._v(" "),e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sanic_testing"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("testing "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" SanicTestClient\n\ntest_client "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" SanicTestClient"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/endpoint"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),e("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("p",[t._v("A third option for starting the test client is to use the "),e("code",[t._v("TestManager")]),t._v(". This is a convenience object that sets up both the "),e("code",[t._v("SanicTestClient")]),t._v(" and the "),e("code",[t._v("SanicASGITestClient")]),t._v(".")])]),t._v(" "),e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sanic_testing "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" TestManager\n\nmgr "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" TestManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test_client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/endpoint"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or")]),t._v("\nmgr"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test_client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/endpoint"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),e("p",[t._v("You can make a request by using one of the following methods")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("SanicTestClient.get")])]),t._v(" "),e("li",[e("code",[t._v("SanicTestClient.post")])]),t._v(" "),e("li",[e("code",[t._v("SanicTestClient.put")])]),t._v(" "),e("li",[e("code",[t._v("SanicTestClient.patch")])]),t._v(" "),e("li",[e("code",[t._v("SanicTestClient.delete")])]),t._v(" "),e("li",[e("code",[t._v("SanicTestClient.options")])]),t._v(" "),e("li",[e("code",[t._v("SanicTestClient.head")])]),t._v(" "),e("li",[e("code",[t._v("SanicTestClient.websocket")])]),t._v(" "),e("li",[e("code",[t._v("SanicTestClient.request")])])]),t._v(" "),e("p",[t._v("You can use these methods "),e("em",[t._v("almost")]),t._v(" identically as you would when using "),e("code",[t._v("httpx")]),t._v(". Any argument that you would pass to "),e("code",[t._v("httpx")]),t._v(" will be accepted, "),e("strong",[t._v("with one caveat")]),t._v(": If you are using "),e("code",[t._v("test_client.request")]),t._v(" and want to manually specify the HTTP method, you should use: "),e("code",[t._v("http_method")]),t._v(":")]),t._v(" "),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[t._v("test_client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/endpoint"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" http_method"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h2",{attrs:{id:"asgi-async-client-sanicasgitestclient"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#asgi-async-client-sanicasgitestclient"}},[t._v("#")]),t._v(" ASGI async client: "),e("code",[t._v("SanicASGITestClient")])]),t._v(" "),e("p",[t._v("Unlike the "),e("code",[t._v("SanicTestClient")]),t._v(" that spins up a server on every request, the "),e("code",[t._v("SanicASGITestClient")]),t._v(" does not. Instead it makes use of the "),e("code",[t._v("httpx")]),t._v(" library to execute Sanic as an ASGI application to reach inside and execute the route handlers.")]),t._v(" "),e("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("p",[t._v("This test client provides all of the same methods and generally works as the "),e("code",[t._v("SanicTestClient")]),t._v(". The only difference is that you will need to add an "),e("code",[t._v("await")]),t._v(" to each call:")])]),t._v(" "),e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test_client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/endpoint"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("SanicASGITestClient")]),t._v(" can be used in the exact same three ways as the "),e("code",[t._v("SanicTestClient")]),t._v(".")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("SanicASGITestClient")]),t._v(" does not need to only be used with ASGI applications. The same way that the "),e("code",[t._v("SanicTestClient")]),t._v(" does not need to only test sync endpoints. Both of these clients are capable of testing "),e("em",[t._v("any")]),t._v(" Sanic application.")])]),t._v(" "),e("h2",{attrs:{id:"persistent-service-client-reusableclient"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#persistent-service-client-reusableclient"}},[t._v("#")]),t._v(" Persistent service client: "),e("code",[t._v("ReusableClient")])]),t._v(" "),e("p",[t._v("This client works under a similar premise as the "),e("code",[t._v("SanicTestClient")]),t._v(" in that it stands up an instance of your application and makes real HTTP requests to it. However, unlike the "),e("code",[t._v("SanicTestClient")]),t._v(", when using the "),e("code",[t._v("ReusableClient")]),t._v(" you control the lifecycle of the application.")]),t._v(" "),e("p",[t._v("That means that every request "),e("strong",[t._v("does not")]),t._v(" start a new web server. Instead you will start the server and stop it as needed and can make multiple requests to the same running instance.")]),t._v(" "),e("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("p",[t._v("Unlike the other two clients, you "),e("strong",[t._v("must")]),t._v(" instantiate this client for use:")])]),t._v(" "),e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sanic_testing"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reusable "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ReusableClient\n\nclient "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ReusableClient"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),e("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("p",[t._v("Once created, you will use the client inside of a context manager. Once outside of the scope of the manager, the server will shutdown.")])]),t._v(" "),e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sanic_testing"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reusable "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ReusableClient\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("test_multiple_endpoints_on_same_server")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    client "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ReusableClient"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        _"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" response "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/1"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" response"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\n\n        _"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" response "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/2"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" response"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\n")])])])])])])}),[],!1,null,null,null);e.default=n.exports}}]);