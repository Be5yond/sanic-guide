(window.webpackJsonp=window.webpackJsonp||[]).push([[196],{529:function(t,s,a){"use strict";a.r(s);var e=a(5),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"テストクライアント"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#テストクライアント"}},[t._v("#")]),t._v(" テストクライアント")]),t._v(" "),s("p",[t._v("3種類のテストクライアントが用意されており、それぞれ異なる機能を備えています。")]),t._v(" "),s("h2",{attrs:{id:"通常同期クライアント-sanictestclient"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通常同期クライアント-sanictestclient"}},[t._v("#")]),t._v(" 通常同期クライアント: "),s("code",[t._v("SanicTestClient")])]),t._v(" "),s("p",[s("code",[t._v("SanicTestClient")]),t._v(" は、あなたのローカルネットワーク上で実際のバージョンの Sanic Server を実行し、テストを実行します。エンドポイントを呼び出すたびに、アプリケーションのバージョンがスピンアップされ、ホスト OS 上のソケットにバインドされます。そして、"),s("code",[t._v("httpx")]),t._v("を使用して、そのアプリケーションに直接呼び出しを行います。")]),t._v(" "),s("p",[t._v("これは Sanic アプリケーションがテストされる典型的な方法です。")]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("Sanic Testing をインストールすると、通常の "),s("code",[t._v("SanicTestClient")]),t._v(" をそのまま使用できるようになります。これは、Sanicが縁の下であなたのために裏の働きを行うからです。")])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test_client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/endpoint"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("しかし、クライアントを自分でインスタンス化することが望ましいと思われるかもしれません。")])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sanic_testing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("testing "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" SanicTestClient\ntest_client "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" SanicTestClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntest_client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/endpoint"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("テストクライアントを起動するための第三の選択肢は、 "),s("code",[t._v("TestManager")]),t._v(" を使用することです。これは、"),s("code",[t._v("SanicTestClient")]),t._v(" と "),s("code",[t._v("SanicASGITestClient")]),t._v(" の両方をセットアップするための便利なオブジェクトです。")])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sanic_testing "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" TestManager\nmgr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" TestManager"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test_client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/endpoint"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or")]),t._v("\nmgr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test_client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/endpoint"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),s("p",[t._v("以下のいずれかの方法でリクエストしてください。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("SanicTestClient.get")])]),t._v(" "),s("li",[s("code",[t._v("SanicTestClient.post")])]),t._v(" "),s("li",[s("code",[t._v("SanicTestClient.put")])]),t._v(" "),s("li",[s("code",[t._v("SanicTestClient.patch")])]),t._v(" "),s("li",[s("code",[t._v("SanicTestClient.delete")])]),t._v(" "),s("li",[s("code",[t._v("SanicTestClient.options")])]),t._v(" "),s("li",[s("code",[t._v("SanicTestClient.head")])]),t._v(" "),s("li",[s("code",[t._v("SanicTestClient.websocket")])]),t._v(" "),s("li",[s("code",[t._v("SanicTestClient.request")])])]),t._v(" "),s("p",[t._v("これらのメソッドは、 "),s("code",[t._v("httpx")]),t._v(" を使用するときと "),s("em",[t._v("ほとんど")]),t._v(" 同じように使用することができます。"),s("code",[t._v("httpx")]),t._v(" に渡すような引数はすべて受け入れられますが、 "),s("strong",[t._v("ひとつだけ注意点があります")]),t._v(" 。もし、 "),s("code",[t._v("test_client.request")]),t._v(" を使用していて、HTTPメソッドを手動で指定したい場合は、以下のようにし、"),s("code",[t._v("http_method")]),t._v("を使用します。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("test_client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/endpoint"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" http_method"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"asgi非同期クライアント-sanicasgitestclient"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#asgi非同期クライアント-sanicasgitestclient"}},[t._v("#")]),t._v(" ASGI非同期クライアント: "),s("code",[t._v("SanicASGITestClient")])]),t._v(" "),s("p",[t._v("リクエストごとにサーバーを起動する "),s("code",[t._v("SanicTestClient")]),t._v(" とは異なり、"),s("code",[t._v("SanicASGITestClient")]),t._v(" はそうではありません。その代わり、"),s("code",[t._v("httpx")]),t._v(" ライブラリを利用して、Sanic を ASGI アプリケーションとして実行し、内部に到達してルートハンドラを実行する。")]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("このテストクライアントは、"),s("code",[t._v("SanicTestClient")]),t._v(" と同じメソッドを提供し、一般的に動作します。唯一の違いは、各コールに "),s("code",[t._v("await")]),t._v(" を追加する必要があることです。")])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test_client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/endpoint"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),s("p",[s("code",[t._v("SanicASGITestClient")]),t._v(" は "),s("code",[t._v("SanicTestClient")]),t._v(" と全く同じ3つの方法で使用することができます。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),s("p",[s("code",[t._v("SanicASGITestClient")]),t._v(" は ASGI アプリケーションにのみ使用する必要はありません。同様に、"),s("code",[t._v("SanicTestClient")]),t._v(" は、同期エンドポイントのみをテストする必要はありません。これらのクライアントはどちらも "),s("em",[t._v("あらゆる")]),t._v(" Sanic アプリケーションをテストすることが可能です。")])]),t._v(" "),s("h2",{attrs:{id:"永続的なサービスクライアント-reusableclient"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#永続的なサービスクライアント-reusableclient"}},[t._v("#")]),t._v(" 永続的なサービスクライアント: "),s("code",[t._v("ReusableClient")])]),t._v(" "),s("p",[t._v("このクライアントは "),s("code",[t._v("SanicTestClient")]),t._v(" と同様の前提で動作し、アプリケーションのインスタンスを立ち上げ、実際に HTTP リクエストを送信します。しかし、"),s("code",[t._v("SanicTestClient")]),t._v(" とは異なり、"),s("code",[t._v("ReusableClient")]),t._v(" を使用する場合は、アプリケーションのライフサイクルを制御することができます。")]),t._v(" "),s("p",[t._v("つまり、すべてのリクエストで新しい Web サーバーが起動されるわけではありません。その代わり、必要に応じてサーバーを起動・停止し、同じインスタンスに対して複数のリクエストを行うことができます。")]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("他の2つのクライアントとは異なり、このクライアントは使用するためにインスタンス化"),s("strong",[t._v("しなければなりません")]),t._v("。")])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sanic_testing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reusable "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ReusableClient\nclient "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ReusableClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("作成したら、クライアントをコンテキスト・マネージャの内部で使用することになります。マネージャの範囲外に出ると、サーバはシャットダウンします。")])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sanic_testing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reusable "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ReusableClient\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("test_multiple_endpoints_on_same_server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    client "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ReusableClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        _"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" response "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\n        _"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" response "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\n")])])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);