(window.webpackJsonp=window.webpackJsonp||[]).push([[238],{568:function(t,s,a){"use strict";a.r(s);var e=a(5),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"日志-logging"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#日志-logging"}},[t._v("#")]),t._v(" 日志(Logging)")]),t._v(" "),s("p",[t._v("Sanic 允许您根据请求进行不同类型的记录（访问日志、错误日志）"),s("a",{attrs:{href:"https://docs.python.org/3/howto/logging.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Python 日志 API"),s("OutboundLink")],1),t._v("。如果您想创建一个新的配置，您应该有一些关于 Python logging 的基础知识。")]),t._v(" "),s("h2",{attrs:{id:"快速开始-quick-start"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快速开始-quick-start"}},[t._v("#")]),t._v(" 快速开始(Quick Start)")]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("使用默认配置的简单示例如下：")])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sanic "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Sanic\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sanic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" logger\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sanic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("response "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" text\n\napp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Sanic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'logging_example'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    logger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("info"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Here is your log'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" text"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello World!'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"__main__"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("debug"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" access_log"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),s("p",[t._v("在服务器运行后，您应该看到以下的日志信息：")]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[2021-01-04 15:26:26 +0200] [1929659] [INFO] Goin' Fast @ http://127.0.0.1:8000\n[2021-01-04 15:26:26 +0200] [1929659] [INFO] Starting worker [1929659]\n")])])]),s("p",[t._v("您可以尝试向服务器发送请求，之后，您会看到输出如下的日志信息：")]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[2021-01-04 15:26:28 +0200] [1929659] [INFO] Here is your log\n[2021-01-04 15:26:28 +0200] - (sanic.access)[INFO][127.0.0.1:44228]: GET http://localhost:8000/  200 -1\n")])])]),s("h2",{attrs:{id:"自定义日志-changing-sanic-loggers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义日志-changing-sanic-loggers"}},[t._v("#")]),t._v(" 自定义日志(Changing Sanic loggers)")]),t._v(" "),s("p",[t._v("如果要使用自己的日志配置，只需使用 "),s("code",[t._v("logging.config.dictConfig")]),t._v("，或者在初始化 Sanic app 时传递 "),s("code",[t._v("log_config")]),t._v(" 即可。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Sanic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'logging_example'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" log_config"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("LOGGING_CONFIG"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"__main__"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("access_log"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("FYI 小提示")]),t._v(" "),s("p",[t._v("在 Python 中处理日志是一个比较轻松的操作，但是如果您需要处理大量的请求，那么性能可能回成为一个瓶颈。添加访问日志的耗时将会增加，这将会增大您的系统开销。")]),t._v(" "),s("p",[t._v("使用 Nginx 记录访问日志是一个减轻系统开销的好办法，将 Sanic 部署在 Nginx 代理之后，并禁用 Sanic 的 "),s("code",[t._v("access_log")]),t._v("，您将能够看到性能的显著提升")]),t._v(" "),s("p",[t._v("为了在生产环境下获得最佳性能，建议在禁用 "),s("code",[t._v("debug")]),t._v(" 和 "),s("code",[t._v("access_log")]),t._v(" 的情况下运行Sanic："),s("code",[t._v("app.run(debug=False, access_log=False)")])])]),t._v(" "),s("h2",{attrs:{id:"配置-configuration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-configuration"}},[t._v("#")]),t._v(" 配置(Configuration)")]),t._v(" "),s("p",[t._v("Sanic 的默认认知配置为："),s("code",[t._v("sanic.log.LOGGING_CONFIG_DEFAULTS")]),t._v("。")]),t._v(" "),s("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[s("p",[t._v("Sanic 使用了三个日志器，如果您想要创建并使用自己的日志配置，则您需要自定义该配置：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("Logger Name")])]),t._v(" "),s("th",[s("strong",[t._v("Use Case")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("sanic.root")])]),t._v(" "),s("td",[t._v("Used to log inernal messages.")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("sanic.error")])]),t._v(" "),s("td",[t._v("Used to log error logs.")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("sanic.access")])]),t._v(" "),s("td",[t._v("Used to log access logs.")])])])])]),t._v(" "),s("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}})]),t._v(" "),s("h3",{attrs:{id:"日志格式-log-format"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#日志格式-log-format"}},[t._v("#")]),t._v(" 日志格式（Log format）")]),t._v(" "),s("p",[t._v("除了 Python 提供的默认参数("),s("code",[t._v("asctime")]),t._v("、"),s("code",[t._v("levelname")]),t._v("、"),s("code",[t._v("message")]),t._v(")之外，Sanic 还为日志器提供了附加参数：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("参数名称")]),t._v(" "),s("th",[t._v("参数值")]),t._v(" "),s("th",[t._v("参数类型")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("host")])]),t._v(" "),s("td",[s("code",[t._v("request.ip")])]),t._v(" "),s("td",[s("code",[t._v("str")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("request")])]),t._v(" "),s("td",[s("code",[t._v('request.method + " " + request.url')])]),t._v(" "),s("td",[s("code",[t._v("str")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("status")])]),t._v(" "),s("td",[s("code",[t._v("response")])]),t._v(" "),s("td",[s("code",[t._v("int")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("byte")])]),t._v(" "),s("td",[s("code",[t._v("len(response.body)")])]),t._v(" "),s("td",[s("code",[t._v("int")])])])])]),t._v(" "),s("p",[t._v("默认的访问日志格式为:")]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("%(asctime)s - (%(name)s)[%(levelname)s][%(host)s]: %(request)s %(message)s %(status)d %(byte)d\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);