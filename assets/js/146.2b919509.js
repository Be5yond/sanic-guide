(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{466:function(t,a,s){"use strict";s.r(a);var e=s(4),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"sanicの実行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sanicの実行"}},[t._v("#")]),t._v(" Sanicの実行")]),t._v(" "),a("p",[t._v("Sanicには、独自の内部Webサーバが付属しています。ほとんどの状況では、これがデプロイメントに適した方法です。さらに、Sanicは、ASGI対応ウェブサーバーにバンドルされたASGIアプリとして、またはgunicornを使用してデプロイすることもできます。")]),t._v(" "),a("h2",{attrs:{id:"sanicサーバー"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sanicサーバー"}},[t._v("#")]),t._v(" Sanicサーバー")]),t._v(" "),a("p",[a("code",[t._v("sanic.Sanic")]),t._v("の場合、次のキーワード引数を使用してrunメソッドを呼び出すことができます。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("Parameter")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Default")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("host")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v('"127.0.0.1"')])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("サーバーをホストするアドレス。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("port")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("8000")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("サーバをホストするポート。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("unix")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("None")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("サーバをホストするUnixソケット名 (TCPではありません)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("debug")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("False")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("デバッグ出力をイネーブルにします (サーバの速度が低下します)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("ssl")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("None")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("workersのSSL暗号化のためのSSLContext。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("sock")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("None")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("サーバーがからの接続を受け入れるためのソケット。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("workers")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("1")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("作成するworkersもしくはprocessの数")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("loop")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("None")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("非同期互換イベントループ。何も指定しないのであれば、独自のイベントループが作成されます")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("protocol")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("HttpProtocol")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("asyncio.protocolのサブクラス。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("access_log")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("True")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("要求の処理でログオンを有効にします (サーバの処理速度が大幅に低下します) 。")])])])]),t._v(" "),a("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("p",[t._v("上記の例では、パフォーマンスを向上させるためにアクセスログをオフにしました。")])]),t._v(" "),a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# server.py")]),t._v("\napp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Sanic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"My App"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.0.0.0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" access_log"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),a("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("p",[a("code",[t._v("app.run(...)")]),t._v("を持つPythonスクリプトを実行します。")])]),t._v(" "),a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("python server.py\n")])])])])]),t._v(" "),a("h3",{attrs:{id:"workers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#workers"}},[t._v("#")]),t._v(" Workers")]),t._v(" "),a("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("p",[t._v("デフォルトでは、Sanicは1つのCPUコアだけを使用してメインプロセスをリッスンします。具体的には、run引数にworkersの数を指定します。")])]),t._v(" "),a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.0.0.0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" workers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),a("p",[t._v("Sanicは自動的に複数のプロセスを起動し、それらの間でトラフィックをルーティングする。使用可能なプロセッサと同じ数のworkersを推奨します。")]),t._v(" "),a("div",{staticClass:"custom-block new"},[a("p",{staticClass:"custom-block-title"},[t._v("NEW in v21.12")]),t._v(" "),a("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("p",[t._v("CPUの性能を最大限に引き出す最も簡単な方法は、 "),a("code",[t._v("fast")]),t._v(" オプションを使用することです。これは、システムの制約を考慮して、自動的に最大数のワーカーを実行します。")])]),t._v(" "),a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.0.0.0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fast"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("$ sanic server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("fast\n")])])])])])]),t._v(" "),a("p",[t._v("古いバージョンのSanicで "),a("code",[t._v("fast")]),t._v(" オプションがない場合、LinuxベースのOSでよくある確認方法を試してみてください。。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ nproc\n")])])]),a("p",[t._v("Or, let Python do it:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" multiprocessing\nworkers "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" multiprocessing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpu_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" workers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("workers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"viaコマンドの実行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#viaコマンドの実行"}},[t._v("#")]),t._v(" viaコマンドの実行")]),t._v(" "),a("h4",{attrs:{id:"sanic-cli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sanic-cli"}},[t._v("#")]),t._v(" Sanic CLI")]),t._v(" "),a("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("p",[t._v("コマンドラインから起動できるシンプルなCLIも用意されています。")]),t._v(" "),a("p",[t._v("たとえば、"),a("code",[t._v("server.py")]),t._v("という名前のファイルでアプリケーションとしてSanicを初期化した場合、次のようにサーバを実行できます。")])]),t._v(" "),a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("sanic server.app "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--workers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n")])])])])]),t._v(" "),a("p",[t._v("すべてのオプションを表示するには、"),a("code",[t._v("sanic --help")]),t._v("を使用します。")]),t._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ sanic --help\nusage: sanic [-h] [--version] [--factory] [-s] [-H HOST] [-p PORT] [-u UNIX] [--cert CERT] [--key KEY] [--tls DIR] [--tls-strict-host]\n             [-w WORKERS | --fast] [--access-logs | --no-access-logs] [--debug] [-d] [-r] [-R PATH] [--motd | --no-motd] [-v]\n             [--noisy-exceptions | --no-noisy-exceptions]\n             module\n\n  ▄███ █████ ██      ▄█▄      ██       █   █   ▄██████████\n  ██                 █   █     █ ██     █   █  ██\n   ▀███████ ███▄    ▀     █    █   ██   ▄   █  ██\n               ██  █████████   █     ██ █   █  ▄▄\n  ████ ████████▀  █         █  █       ██   █   ▀██ ███████\n\n To start running a Sanic application, provide a path to the module, where\n app is a Sanic() instance:\n\n     $ sanic path.to.server:app\n\n Or, a path to a callable that returns a Sanic() instance:\n\n     $ sanic path.to.factory:create_app --factory\n\n Or, a path to a directory to run as a simple HTTP server:\n\n     $ sanic ./path/to/static --simple\n\nRequired\n========\n  Positional:\n    module                         Path to your Sanic app. Example: path.to.server:app\n                                   If running a Simple Server, path to directory to serve. Example: ./\n\nOptional\n========\n  General:\n    -h, --help                     show this help message and exit\n    --version                      show program's version number and exit\n\n  Application:\n    --factory                      Treat app as an application factory, i.e. a () -> &lt;Sanic app> callable\n    -s, --simple                   Run Sanic as a Simple Server, and serve the contents of a directory\n                                   (module arg should be a path)\n\n  Socket binding:\n    -H HOST, --host HOST           Host address [default 127.0.0.1]\n    -p PORT, --port PORT           Port to serve on [default 8000]\n    -u UNIX, --unix UNIX           location of unix socket\n\n  TLS certificate:\n    --cert CERT                    Location of fullchain.pem, bundle.crt or equivalent\n    --key KEY                      Location of privkey.pem or equivalent .key file\n    --tls DIR                      TLS certificate folder with fullchain.pem and privkey.pem\n                                   May be specified multiple times to choose multiple certificates\n    --tls-strict-host              Only allow clients that send an SNI matching server certs\n\n  Worker:\n    -w WORKERS, --workers WORKERS  Number of worker processes [default 1]\n    --fast                         Set the number of workers to max allowed\n    --access-logs                  Display access logs\n    --no-access-logs               No display access logs\n\n  Development:\n    --debug                        Run the server in debug mode\n    -d, --dev                      Currently is an alias for --debug. But starting in v22.3, \n                                   --debug will no longer automatically trigger auto_restart. \n                                   However, --dev will continue, effectively making it the \n                                   same as debug + auto_reload.\n    -r, --reload, --auto-reload    Watch source directory for file changes and reload on changes\n    -R PATH, --reload-dir PATH     Extra directories to watch and reload on changes\n\n  Output:\n    --motd                         Show the startup display\n    --no-motd                      No show the startup display\n    -v, --verbosity                Control logging noise, eg. -vv or --verbosity=2 [default 0]\n    --noisy-exceptions             Output stack traces for all exceptions\n    --no-noisy-exceptions          No output stack traces for all exceptions\n")])])]),a("h4",{attrs:{id:"モジュールとして"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#モジュールとして"}},[t._v("#")]),t._v(" モジュールとして")]),t._v(" "),a("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("p",[t._v("モジュールとして直接呼び出すこともできます。")])]),t._v(" "),a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("python "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" sanic server.app "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--workers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n")])])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("FYI")]),t._v(" "),a("p",[t._v("どちらの方法(CLIまたはモジュール)でも、Pythonファイルの"),a("code",[t._v("app.run()")]),t._v("を"),a("em",[t._v("呼び出さない")]),t._v("でください。もしも実行する場合は、インタプリタによって直接実行される場合にのみ実行されるようにラップしてください。")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.0.0.0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" workers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),a("h4",{attrs:{id:"sanicシンプルサーバー"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sanicシンプルサーバー"}},[t._v("#")]),t._v(" Sanicシンプルサーバー")]),t._v(" "),a("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("p",[t._v("提供する必要がある静的ファイルのディレクトリだけがある場合もあります。これは特に、localhostサーバーを素早く立ち上げる場合に便利です。SanicにはSimple Serverが付属しており、ディレクトリを指定するだけです。")])]),t._v(" "),a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("sanic ./path/to/dir "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--simple")]),t._v("\n")])])])])]),t._v(" "),a("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("p",[t._v("自動リロードと組み合わせることもできます。")])]),t._v(" "),a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("sanic ./path/to/dir "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--simple")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--reload")]),t._v(" --reload-dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("./path/to/dir\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"asgi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#asgi"}},[t._v("#")]),t._v(" ASGI")]),t._v(" "),a("p",[t._v("SanicもASGIに準拠しています。つまり、任意のASGI Webサーバを使用してSanicを実行できます。ASGIの3つの主要な実装は、"),a("a",{attrs:{href:"http://github.com/django/daphne",target:"_blank",rel:"noopener noreferrer"}},[t._v("Daphne"),a("OutboundLink")],1),t._v(","),a("a",{attrs:{href:"https://www.uvicorn.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Uvicorn"),a("OutboundLink")],1),t._v(",と"),a("a",{attrs:{href:"https://pgjones.gitlab.io/hypercorn/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hypercorn"),a("OutboundLink")],1),t._v("です。")]),t._v(" "),a("p",[t._v("実行方法は次のようになります。\n※適切な実行方法についてはドキュメントを参照してください。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("daphne myapp:app\nuvicorn myapp:app\nhypercorn myapp:app\n")])])]),a("p",[t._v("ASGIを使用する際には、次の点に注意してください。")]),t._v(" "),a("ol",[a("li",[t._v("Sanic Webサーバを使用する場合、websocketsは"),a("code",[t._v("websockets")]),t._v("パッケージを使用して実行されますが。ASGIモードでは、websocketsはASGIサーバで管理されるため、このパッケージは必要ありません。")]),t._v(" "),a("li",[t._v("ASGIライフスパンプロトコルは、スタートアップとシャットダウンの2つのサーバイベントだけをサポートします。Sanicには、起動前、起動後、シャットダウン前、シャットダウン後の4つがあります。したがって、ASGIモードでは、スタートアップイベントとシャットダウンイベントは連続して実行され、実際にはサーバプロセスの開始と終了の前後では実行されません(なぜなら現在、ASGIサーバによって制御されているためです)。したがって、"),a("code",[t._v("after_server_start")]),t._v("および"),a("code",[t._v("before_server_stop")]),t._v("を使用することをお薦めします。")])]),t._v(" "),a("h3",{attrs:{id:"trio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#trio"}},[t._v("#")]),t._v(" Trio")]),t._v(" "),a("p",[t._v("SanicはTrio上での実行を実験的にサポートしています。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("hypercorn -k trio myapp:app\n")])])]),a("h2",{attrs:{id:"gunicorn"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gunicorn"}},[t._v("#")]),t._v(" Gunicorn")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://gunicorn.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gunicorn"),a("OutboundLink")],1),t._v('("Green Unicorn")は、UNIXベースのオペレーティング・システム用のWSGI HTTP Serverです。これはRubyのUnicornプロジェクトから移植されたフォーク前のworkerモデルです。')]),t._v(" "),a("p",[t._v("GunicornでSanicアプリケーションを実行するには、特殊な"),a("code",[t._v("sanic.worker.GunicornWorker")]),t._v("を実行する必要があります:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("gunicorn myapp:app "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--bind")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:1337 --worker-class sanic.worker.GunicornWorker\n")])])]),a("p",[t._v("アプリケーションでメモリリークが発生した場合、Gunicornを設定して、指定した数のリクエストを処理したあとでワーカーを正常に再起動できます。これは、メモリリークの影響を制限するのに役立つ便利な方法です。")]),t._v(" "),a("p",[t._v("詳細については、"),a("a",{attrs:{href:"http://docs.gunicorn.org/en/latest/settings.html#max-requests",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gunicorn Docs"),a("OutboundLink")],1),t._v(" を参照してください。")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[a("code",[t._v("gunicorn")]),t._v("経由でSanicを実行すると、"),a("code",[t._v("async/await")]),t._v("のパフォーマンス上の利点の多くを失うことになります。慎重に検討してから選択してください。Gunicornには多くの設定オプションが用意されていますが、Sanicを最速で動作させるには最適な選択肢ではありません。")])]),t._v(" "),a("h2",{attrs:{id:"パフォーマンスに関する考慮事項"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#パフォーマンスに関する考慮事項"}},[t._v("#")]),t._v(" パフォーマンスに関する考慮事項")]),t._v(" "),a("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("p",[t._v("本番環境で実行する場合は、"),a("code",[t._v("debug")]),t._v("を必ずオフにしてください。")])]),t._v(" "),a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" debug"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),a("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("p",[t._v("また、"),a("code",[t._v("access_log")]),t._v("をオフにすると、Sanicは最も高速に動作します。")]),t._v(" "),a("p",[t._v("それでもアクセスログが必要だが、このパフォーマンス向上を享受したい場合は、"),a("RouterLink",{attrs:{to:"/ja/guide/deployment/nginx.html"}},[t._v("Nginxをプロキシとして")]),t._v("使用すればアクセスログを処理できます。Pythonが処理できるものよりもはるかに高速になります。")],1)]),t._v(" "),a("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" access_log"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])])])}),[],!1,null,null,null);a.default=n.exports}}]);