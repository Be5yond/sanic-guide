(window.webpackJsonp=window.webpackJsonp||[]).push([[269],{595:function(t,a,e){"use strict";e.r(a);var s=e(4),n=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"version-21-9"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#version-21-9"}},[t._v("#")]),t._v(" Version 21.9")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#介绍-introduction"}},[t._v("介绍(Introduction)")])]),a("li",[a("a",{attrs:{href:"#更新内容-what-to-know"}},[t._v("更新内容(What to know)")]),a("ul",[a("li",[a("a",{attrs:{href:"#移除配置项-websocket-read-limit-websocket-write-limit-和-websocket-max-queue"}},[t._v("移除配置项：WEBSOCKET_READ_LIMIT，WEBSOCKET_WRITE_LIMIT 和 WEBSOCKET_MAX_QUEUE")])]),a("li",[a("a",{attrs:{href:"#弃用-fallback-error-format-配置项的默认值"}},[t._v("弃用 FALLBACK_ERROR_FORMAT 配置项的默认值")])]),a("li",[a("a",{attrs:{href:"#errorhandler-lookup-函数签名改动-errorhandler-lookup-signature-deprecation"}},[t._v("ErrorHandler.lookup 函数签名改动(ErrorHandler.lookup signature deprecation)")])]),a("li",[a("a",{attrs:{href:"#未来移除项备忘录-reminder-of-upcoming-removals"}},[t._v("未来移除项备忘录(Reminder of upcoming removals)")])]),a("li",[a("a",{attrs:{href:"#websockets-重构-overhaul-of-websockets"}},[t._v("websockets 重构(Overhaul of websockets)")])]),a("li",[a("a",{attrs:{href:"#内置信号-built-in-signals"}},[t._v("内置信号(Built-in signals)")])]),a("li",[a("a",{attrs:{href:"#更加智能的格式化异常-auto-smarter-auto-exception-formatting"}},[t._v("更加智能的格式化异常：auto(Smarter auto exception formatting)")])]),a("li",[a("a",{attrs:{href:"#蓝图拷贝-blueprint-copying"}},[t._v("蓝图拷贝(Blueprint copying)")])]),a("li",[a("a",{attrs:{href:"#蓝图组便捷方法-blueprint-group-convenience-methods"}},[t._v("蓝图组便捷方法(Blueprint group convenience methods)")])]),a("li",[a("a",{attrs:{href:"#accept-头解析-accept-header-parsing"}},[t._v("Accept 头解析(Accept header parsing)")])]),a("li",[a("a",{attrs:{href:"#默认异常信息-default-exception-messages"}},[t._v("默认异常信息(Default exception messages)")])]),a("li",[a("a",{attrs:{href:"#方便的类型注释-type-annotation-conveniences"}},[t._v("方便的类型注释(Type annotation conveniences)")])]),a("li",[a("a",{attrs:{href:"#明确静态资源类型-explicit-static-resource-type"}},[t._v("明确静态资源类型(Explicit static resource type)")])])])]),a("li",[a("a",{attrs:{href:"#新闻-news"}},[t._v("新闻(News)")]),a("ul",[a("li",[a("a",{attrs:{href:"#发布-sanic-ext-并且弃用-sanic-openapi-release-of-sanic-ext-and-deprecation-of-sanic-openapi"}},[t._v("发布 sanic-ext 并且弃用 sanic-openapi(Release of sanic-ext and deprecation of sanic-openapi)")])])])]),a("li",[a("a",{attrs:{href:"#鸣谢-thank-you"}},[t._v("鸣谢(Thank you)")])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"介绍-introduction"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍-introduction"}},[t._v("#")]),t._v(" 介绍(Introduction)")]),t._v(" "),a("p",[t._v("21.9 版本是 "),a("RouterLink",{attrs:{to:"/zh/guide/project/policies.html#release-schedule"}},[t._v("21 版本周期")]),t._v("中的第三个版本。21 版本将会在 12 月发布长期支持版本。")],1),t._v(" "),a("h2",{attrs:{id:"更新内容-what-to-know"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新内容-what-to-know"}},[t._v("#")]),t._v(" 更新内容(What to know)")]),t._v(" "),a("p",[t._v("更多细节详见"),a("a",{attrs:{href:"https://sanic.readthedocs.io/en/stable/sanic/changelog.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("发布说明"),a("OutboundLink")],1),t._v("。以下是值得注意的新功能或突破性变化，以及更新内容...")]),t._v(" "),a("h3",{attrs:{id:"移除配置项-websocket-read-limit-websocket-write-limit-和-websocket-max-queue"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#移除配置项-websocket-read-limit-websocket-write-limit-和-websocket-max-queue"}},[t._v("#")]),t._v(" 移除配置项："),a("code",[t._v("WEBSOCKET_READ_LIMIT")]),t._v("，"),a("code",[t._v("WEBSOCKET_WRITE_LIMIT")]),t._v(" 和 "),a("code",[t._v("WEBSOCKET_MAX_QUEUE")])]),t._v(" "),a("p",[t._v("随着 websocket 的完全重构，上述配置项将被移除。目前还没有计划安排替代选项。")]),t._v(" "),a("h3",{attrs:{id:"弃用-fallback-error-format-配置项的默认值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#弃用-fallback-error-format-配置项的默认值"}},[t._v("#")]),t._v(" 弃用 "),a("code",[t._v("FALLBACK_ERROR_FORMAT")]),t._v(" 配置项的默认值")]),t._v(" "),a("p",[t._v("当没有添加异常处理程序时，Sanic 使用 "),a("code",[t._v("html")]),t._v(" 作为默认的格式类型。这点已被废弃了，从 v22.3 开始将改为 "),a("code",[t._v("text")]),t._v(" 。虽然它的值已经变成了 "),a("code",[t._v("auto")]),t._v(" ，但在 v21.12LTS 之前，它仍将继续使用 HTML 作为默认值。")]),t._v(" "),a("h3",{attrs:{id:"errorhandler-lookup-函数签名改动-errorhandler-lookup-signature-deprecation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#errorhandler-lookup-函数签名改动-errorhandler-lookup-signature-deprecation"}},[t._v("#")]),t._v(" "),a("code",[t._v("ErrorHandler.lookup")]),t._v(" 函数签名改动("),a("code",[t._v("ErrorHandler.lookup")]),t._v(" signature deprecation)")]),t._v(" "),a("p",[t._v("现在， "),a("code",[t._v("ErrorHandler.lookup")]),t._v(" 方法 "),a("strong",[t._v("必须要求")]),t._v(" 传入 2 个参数:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lookup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exception"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" route_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Optional"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])])]),a("p",[t._v("这将意味着不满足这个签名的异常处理程序将会注册失败。")]),t._v(" "),a("h3",{attrs:{id:"未来移除项备忘录-reminder-of-upcoming-removals"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#未来移除项备忘录-reminder-of-upcoming-removals"}},[t._v("#")]),t._v(" 未来移除项备忘录(Reminder of upcoming removals)")]),t._v(" "),a("p",[t._v("作为备忘，下述项已经被弃用，并且会将在 21.12LTS 版本中被移除")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("CompositionView")])]),t._v(" "),a("li",[a("code",[t._v("load_env")]),t._v(" (使用 "),a("code",[t._v("env_prefix")]),t._v(" 代替)")]),t._v(" "),a("li",[t._v("Sanic 对象 (应用实例, 蓝图和路由) 必须只能是包含数字和字母的组合: "),a("code",[t._v("^[a-zA-Z] [a-zA-Z0-9_\\-]*$")])]),t._v(" "),a("li",[t._v("任意分配对象到应用程序和蓝图实例（使用 "),a("code",[t._v("ctx")]),t._v(" 代替；移除随意分配已经从 21.9 移到 21.12。）")])]),t._v(" "),a("h3",{attrs:{id:"websockets-重构-overhaul-of-websockets"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#websockets-重构-overhaul-of-websockets"}},[t._v("#")]),t._v(" websockets 重构(Overhaul of websockets)")]),t._v(" "),a("p",[t._v("在处理 websocket 上，有一些巨大的改动。 多谢了 "),a("a",{attrs:{href:"https://github.com/aaugustin",target:"_blank",rel:"noopener noreferrer"}},[t._v("@aaugustin"),a("OutboundLink")],1),t._v(" 现在 "),a("a",{attrs:{href:"https://websockets.readthedocs.io/en/stable/index.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("websockets")]),a("OutboundLink")],1),t._v(" 已经有了全新的实现，这也允许 Sanic 自己 websocket 链接。")]),t._v(" "),a("p",[t._v("因此，Sanic 将修改最低依赖版本至 "),a("code",[t._v("websockets>=10.0")]),t._v("。")]),t._v(" "),a("p",[t._v("除了 websocket 处理函数在异常捕获时的一些非正常情况被修复外，这些变动应该对于开发者来说没有太大影响。举例来说，您现在应该可以在断开连接时正常捕获到 "),a("code",[t._v("CancelledError")]),t._v(" 异常。")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("websocket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" asyncio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.25")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),t._v(" asyncio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CancelledError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"User closed connection"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"内置信号-built-in-signals"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内置信号-built-in-signals"}},[t._v("#")]),t._v(" 内置信号(Built-in signals)")]),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/zh/guide/release-notes/v21.3.html"}},[t._v("21.3")]),t._v(" 版本中介绍了 "),a("RouterLink",{attrs:{to:"/zh/guide/advanced/signals.html"}},[t._v("信号")]),t._v("。现在，Sanic 原生支持触发信号事件。这意味着开发者将可以在完整的请求/响应生命周期中注入自己的钩子函数。")],1),t._v(" "),a("p",[t._v("在这之前，如果您想注入一些逻辑，您只能使用中间件。把集成信号看作是 "),a("strong",[t._v("超级中间件")]),t._v("。")]),t._v(" "),a("p",[t._v("下列是会触发的事件列表：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("http.lifecycle.begin")])]),t._v(" "),a("li",[a("code",[t._v("http.lifecycle.complete")])]),t._v(" "),a("li",[a("code",[t._v("http.lifecycle.exception")])]),t._v(" "),a("li",[a("code",[t._v("http.lifecycle.handle")])]),t._v(" "),a("li",[a("code",[t._v("http.lifecycle.read_body")])]),t._v(" "),a("li",[a("code",[t._v("http.lifecycle.read_head")])]),t._v(" "),a("li",[a("code",[t._v("http.lifecycle.request")])]),t._v(" "),a("li",[a("code",[t._v("http.lifecycle.response")])]),t._v(" "),a("li",[a("code",[t._v("http.lifecycle.send")])]),t._v(" "),a("li",[a("code",[t._v("http.middleware.after")])]),t._v(" "),a("li",[a("code",[t._v("http.middleware.before")])]),t._v(" "),a("li",[a("code",[t._v("http.routing.after")])]),t._v(" "),a("li",[a("code",[t._v("http.routing.before")])]),t._v(" "),a("li",[a("code",[t._v("server.init.after")])]),t._v(" "),a("li",[a("code",[t._v("server.init.before")])]),t._v(" "),a("li",[a("code",[t._v("server.shutdown.after")])]),t._v(" "),a("li",[a("code",[t._v("server.shutdown.before")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("备注")]),t._v(" "),a("p",[a("code",[t._v("server")]),t._v(" 信号和四个主服务监听器是一样。事实上，这些监听器本身就是使用信号来实现的。")])]),t._v(" "),a("h3",{attrs:{id:"更加智能的格式化异常-auto-smarter-auto-exception-formatting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更加智能的格式化异常-auto-smarter-auto-exception-formatting"}},[t._v("#")]),t._v(" 更加智能的格式化异常："),a("code",[t._v("auto")]),t._v("(Smarter "),a("code",[t._v("auto")]),t._v(" exception formatting)")]),t._v(" "),a("p",[t._v("Sanic 现在会尝试根据端点和客户端去返回一个合适的异常信息格式。比如，如果您的端点总是返回 "),a("code",[t._v("sanic.response.json")]),t._v(" 对象，那么任何异常将会被自动得格式化成 JSON。"),a("code",[t._v("text")]),t._v(" 和 "),a("code",[t._v("html")]),t._v(" 响应同理。")]),t._v(" "),a("p",[t._v("此外，您可以在定义路由的时候 "),a("em",[t._v("精确地")]),t._v(" 控制异常格式化的方式：")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error_format"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"json"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\n")])])]),a("h3",{attrs:{id:"蓝图拷贝-blueprint-copying"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#蓝图拷贝-blueprint-copying"}},[t._v("#")]),t._v(" 蓝图拷贝(Blueprint copying)")]),t._v(" "),a("p",[t._v("蓝图可以被复制到新的实例中。这将会复制所有在该蓝图上注册的控制程序，如路由、中间件等。")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("v1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Blueprint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Version1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" version"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@v1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/something"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("something")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\n\nv2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" v1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("copy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Version2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" version"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("blueprint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("v1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("blueprint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("v2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("/v1/something\n/v2/something\n")])])]),a("h3",{attrs:{id:"蓝图组便捷方法-blueprint-group-convenience-methods"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#蓝图组便捷方法-blueprint-group-convenience-methods"}},[t._v("#")]),t._v(" 蓝图组便捷方法(Blueprint group convenience methods)")]),t._v(" "),a("p",[t._v("蓝图组现在拥有与普通蓝图拥有相同的方法，加上复制功能，蓝图现在可以被十分灵活得组合。")]),t._v(" "),a("h3",{attrs:{id:"accept-头解析-accept-header-parsing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#accept-头解析-accept-header-parsing"}},[t._v("#")]),t._v(" Accept 头解析(Accept header parsing)")]),t._v(" "),a("p",[t._v("Sanic "),a("code",[t._v("Request")]),t._v(" 对象可以解析 "),a("code",[t._v("Accept")]),t._v(" 头信息，并会将头信息组织一个有序列表，该头信息代表着客户端倾向的数据类型 (content-type)。您可以通过以下属性非常简单的获取该值：")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("accept"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# ["*/*"]')]),t._v("\n")])])]),a("p",[t._v("它还能够处理通配符。举个例子，假设有如下请求：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Accept: */*\n")])])]),a("p",[t._v("那么，下述代码执行的结果为 "),a("code",[t._v("True")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text/plain"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("accept\n")])])]),a("h3",{attrs:{id:"默认异常信息-default-exception-messages"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#默认异常信息-default-exception-messages"}},[t._v("#")]),t._v(" 默认异常信息(Default exception messages)")]),t._v(" "),a("p",[t._v("任何继承自 "),a("code",[t._v("SanicException")]),t._v(" 的异常现在可以定义一个默认的信息。这使得异常的重用更加方便，也使得异常更可维护，同时让您远离 一次且仅一次 (DRY) 问题。")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TeaError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("SanicException"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    message "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Tempest in a teapot"')]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("raise")]),t._v(" TeaError\n")])])]),a("h3",{attrs:{id:"方便的类型注释-type-annotation-conveniences"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方便的类型注释-type-annotation-conveniences"}},[t._v("#")]),t._v(" 方便的类型注释(Type annotation conveniences)")]),t._v(" "),a("p",[t._v("现在，您可以使用 Python 的类型注释来控制路径参数。")]),t._v(" "),a("p",[t._v("之前，您可能需要这么定义路径参数：")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/<one:int>/<two:float>/<three:uuid>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" one"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" two"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" three"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" UUID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),a("p",[t._v("现在，您有更加方便的写法：")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/<one>/<two>/<three>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" one"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" two"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" three"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" UUID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),a("p",[t._v("上述两个例子拥有同样的效果。")]),t._v(" "),a("h3",{attrs:{id:"明确静态资源类型-explicit-static-resource-type"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#明确静态资源类型-explicit-static-resource-type"}},[t._v("#")]),t._v(" 明确静态资源类型(Explicit static resource type)")]),t._v(" "),a("p",[t._v("您现在可以明确 "),a("code",[t._v("static")]),t._v(" 的路由处理的资源类型，告知该路由应该把资源当作文件还是目录来处理：")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("static"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/some/file"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" resource_type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"file"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"新闻-news"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新闻-news"}},[t._v("#")]),t._v(" 新闻(News)")]),t._v(" "),a("h3",{attrs:{id:"发布-sanic-ext-并且弃用-sanic-openapi-release-of-sanic-ext-and-deprecation-of-sanic-openapi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发布-sanic-ext-并且弃用-sanic-openapi-release-of-sanic-ext-and-deprecation-of-sanic-openapi"}},[t._v("#")]),t._v(" 发布 "),a("code",[t._v("sanic-ext")]),t._v(" 并且弃用 "),a("code",[t._v("sanic-openapi")]),t._v("(Release of "),a("code",[t._v("sanic-ext")]),t._v(" and deprecation of "),a("code",[t._v("sanic-openapi")]),t._v(")")]),t._v(" "),a("p",[t._v("Sanic 的其中一个核心原则就是，它应该是一个工具，而不是一个独裁者。正如我们在首页中提到的那样：")]),t._v(" "),a("blockquote",[a("p",[t._v("按照您的意愿进行自由创建，不会对您造成任何约束")])]),t._v(" "),a("p",[t._v("这意味着很多通用的功能（特别是 Web Api 开发者经常使用的那些）将不会被集成到 "),a("code",[t._v("sanic")]),t._v(" 主仓库中。这样做的好处是不限制开发者的自由创作，不会产生任何约束。")]),t._v(" "),a("p",[t._v("但是，有时您不想去反复编写那些相同的东西。到目前为止，Sanic 依赖社区提供强大支持来填补插件的空白。")]),t._v(" "),a("p",[t._v("早些时候，有一个官方的 "),a("code",[t._v("sanic-openapi")]),t._v(" 包，它提供了基于您的应用来生成 OpenAPI 文档的功能。相比于 Sanic 的主项目，该项目已经多年来都没有给予过足够的关注。")]),t._v(" "),a("p",[t._v("从 v21.9 版本开始，SCO 废弃了 "),a("code",[t._v("sanic-openapi")]),t._v(" 包并且将其转为维护模式。这意味着它将只会进行必要的更新，但它将不会获得任何新的增强功能。")]),t._v(" "),a("p",[t._v("一个名为 "),a("code",[t._v("sanic-ext")]),t._v(" 的新项目取代它的位置。这个包不仅提供了生成 OAS3 文档的能力，而且为 API 开发者进一步铺平了道路。例如，再您使用时，它将设置 CORS，并在需要时自动启用 "),a("code",[t._v("HEAD")]),t._v(" 和 "),a("code",[t._v("OPTIONS")]),t._v(" 响应。它还能够使用标准库 Dataclasses 或Pydantic 模型来进行数据简要。")]),t._v(" "),a("p",[t._v("它提供的功能包括：")]),t._v(" "),a("ul",[a("li",[t._v("CORS 保护")]),t._v(" "),a("li",[t._v("请求参数验证")]),t._v(" "),a("li",[t._v("支持自动生成 OAS3，并且能使用 Redoc 或者 Swagger UI 自动生成文档")]),t._v(" "),a("li",[t._v("自动 "),a("code",[t._v("HEAD")]),t._v(", "),a("code",[t._v("OPTIONS")]),t._v(" "),a("code",[t._v("TRACE")]),t._v(" 响应")]),t._v(" "),a("li",[t._v("依赖注入")]),t._v(" "),a("li",[t._v("序列化响应")])]),t._v(" "),a("p",[t._v("该项目仍然处理 "),a("code",[t._v("alpha")]),t._v(" 测试阶段，随时都会发生改动。虽然它被指望能够胜任生产环境，但随着功能的增加，可能会改变一些 API。")]),t._v(" "),a("p",[t._v("查看"),a("RouterLink",{attrs:{to:"/zh/plugins/sanic-ext/getting-started.html"}},[t._v("插件文档")]),t._v("来获取更多细节。")],1),t._v(" "),a("h2",{attrs:{id:"鸣谢-thank-you"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#鸣谢-thank-you"}},[t._v("#")]),t._v(" 鸣谢(Thank you)")]),t._v(" "),a("p",[t._v("感谢每一位参与本次发布的人：👏")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/aaugustin",target:"_blank",rel:"noopener noreferrer"}},[t._v("@aaugustin"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://github.com/ahopkins",target:"_blank",rel:"noopener noreferrer"}},[t._v("@ahopkins"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://github.com/ashleysommer",target:"_blank",rel:"noopener noreferrer"}},[t._v("@ashleysommer"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://github.com/cansarigol3megawatt",target:"_blank",rel:"noopener noreferrer"}},[t._v("@cansarigol3megawatt"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://github.com/ChihweiLHBird",target:"_blank",rel:"noopener noreferrer"}},[t._v("@ChihweiLHBird"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://github.com/gluhar2006",target:"_blank",rel:"noopener noreferrer"}},[t._v("@gluhar2006"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://github.com/komar007",target:"_blank",rel:"noopener noreferrer"}},[t._v("@komar007"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://github.com/ombe1229",target:"_blank",rel:"noopener noreferrer"}},[t._v("@ombe1229"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://github.com/prryplatypus",target:"_blank",rel:"noopener noreferrer"}},[t._v("@prryplatypus"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://github.com/SaidBySolo",target:"_blank",rel:"noopener noreferrer"}},[t._v("@SaidBySolo"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://github.com/tronic",target:"_blank",rel:"noopener noreferrer"}},[t._v("@Tronic"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://github.com/vltr",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vltr"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("并且，特别感谢 "),a("a",{attrs:{href:"https://github.com/miss85246",target:"_blank",rel:"noopener noreferrer"}},[t._v("@miss85246"),a("OutboundLink")],1),t._v(" 和 "),a("a",{attrs:{href:"https://github.com/ZinkLu",target:"_blank",rel:"noopener noreferrer"}},[t._v("@ZinkLu"),a("OutboundLink")],1),t._v("，他们在同步翻译最新中文文档上付出了巨大精力。")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("如果您喜欢本项目，请考虑参与建设本项目。我们欢迎您提交代码，也欢迎您以任何其他方式来参与本项目的建设。比如撰写文档，分享使用心得，参与社区讨论，当然，如果经济允许，您也可以考虑"),a("a",{attrs:{href:"https://opencollective.com/sanic-org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("经济资助"),a("OutboundLink")],1),t._v("。")])])}),[],!1,null,null,null);a.default=n.exports}}]);