(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{408:function(t,e,a){"use strict";a.r(e);var s=a(4),o=Object(s.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"cors-protection"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cors-protection"}},[t._v("#")]),t._v(" CORS protection")]),t._v(" "),e("p",[t._v("Cross-Origin Resource Sharing (aka CORS) is a "),e("em",[t._v("huge")]),t._v(" topic by itself. The documentation here cannot go into enough detail about "),e("em",[t._v("what")]),t._v(" it is. You are highly encouraged to do some research on your own to understand the security problem presented by it, and the theory behind the solutions. "),e("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN Web Docs"),e("OutboundLink")],1),t._v(" are a great first step.")]),t._v(" "),e("p",[t._v("In super brief terms, CORS protection is a framework that browsers use to facilitate how and when a web page can access information from another domain. It is extremely relevant to anyone building a single-page application. Often times your frontend might be on a domain like "),e("code",[t._v("https://portal.myapp.com")]),t._v(", but it needs to access the backend from "),e("code",[t._v("https://api.myapp.com")]),t._v(".")]),t._v(" "),e("p",[t._v("The implementation here is heavily inspired by "),e("a",{attrs:{href:"https://github.com/ashleysommer/sanic-cors",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("sanic-cors")]),e("OutboundLink")],1),t._v(", which is in turn based upon "),e("a",{attrs:{href:"https://github.com/corydolphin/flask-cors",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("flask-cors")]),e("OutboundLink")],1),t._v(". It is therefore very likely that you can achieve a near drop-in replacement of "),e("code",[t._v("sanic-cors")]),t._v(" with "),e("code",[t._v("sanic-ext")]),t._v(".")]),t._v(" "),e("h2",{attrs:{id:"basic-implementation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#basic-implementation"}},[t._v("#")]),t._v(" Basic implementation")]),t._v(" "),e("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("p",[t._v("As shown in the example in the "),e("RouterLink",{attrs:{to:"/en/plugins/sanic-ext/http/methods.html#options"}},[t._v("auto-endpoints example")]),t._v(", Sanic Extensions will automatically enable CORS protection without further action. But, it does not offer too much out of the box.")],1),t._v(" "),e("p",[t._v("At a "),e("em",[t._v("bare minimum")]),t._v(", it is "),e("strong",[t._v("highly")]),t._v(" recommended that you set "),e("code",[t._v("config.CORS_ORIGINS")]),t._v(" to the intended origin(s) that will be accessing the application.")])]),t._v(" "),e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sanic "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Sanic"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" text\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sanic_ext "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Extend\n\napp "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Sanic"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__name__"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CORS_ORIGINS "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://foobar.com,http://bar.com"')]),t._v("\nExtend"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("hello_world")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" text"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, world."')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ curl localhost:8000 -X OPTIONS -i\nHTTP/1.1 204 No Content\nallow: GET,HEAD,OPTIONS\naccess-control-allow-origin: http://foobar.com\nconnection: keep-alive\n")])])])])]),t._v(" "),e("h2",{attrs:{id:"configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[t._v("#")]),t._v(" Configuration")]),t._v(" "),e("p",[t._v("The true power of CORS protection, however, comes into play once you start configuring it. Here is a table of all of the options.")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Key")]),t._v(" "),e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Default")]),t._v(" "),e("th",[t._v("Description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("code",[t._v("CORS_ALLOW_HEADERS")])]),t._v(" "),e("td",[e("code",[t._v("str")]),t._v(" or "),e("code",[t._v("List[str]")])]),t._v(" "),e("td",[e("code",[t._v('"*"')])]),t._v(" "),e("td",[t._v("The list of headers that will appear in "),e("code",[t._v("access-control-allow-headers")]),t._v(".")])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("CORS_ALWAYS_SEND")])]),t._v(" "),e("td",[e("code",[t._v("bool")])]),t._v(" "),e("td",[e("code",[t._v("True")])]),t._v(" "),e("td",[t._v("When "),e("code",[t._v("True")]),t._v(", will always set a value for "),e("code",[t._v("access-control-allow-origin")]),t._v(". When "),e("code",[t._v("False")]),t._v(", will only set it if there is an "),e("code",[t._v("Origin")]),t._v(" header.")])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("CORS_AUTOMATIC_OPTIONS")])]),t._v(" "),e("td",[e("code",[t._v("bool")])]),t._v(" "),e("td",[e("code",[t._v("True")])]),t._v(" "),e("td",[t._v("When the incoming preflight request is received, whether to automatically set values for "),e("code",[t._v("access-control-allow-headers")]),t._v(", "),e("code",[t._v("access-control-max-age")]),t._v(", and "),e("code",[t._v("access-control-allow-methods")]),t._v(" headers. If "),e("code",[t._v("False")]),t._v(" these values will only be set on routes that are decorated with the "),e("code",[t._v("@cors")]),t._v(" decorator.")])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("CORS_EXPOSE_HEADERS")])]),t._v(" "),e("td",[e("code",[t._v("str")]),t._v(" or "),e("code",[t._v("List[str]")])]),t._v(" "),e("td",[e("code",[t._v('""')])]),t._v(" "),e("td",[t._v("Specific list of headers to be set in "),e("code",[t._v("access-control-expose-headers")]),t._v(" header.")])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("CORS_MAX_AGE")])]),t._v(" "),e("td",[e("code",[t._v("str")]),t._v(", "),e("code",[t._v("int")]),t._v(", "),e("code",[t._v("timedelta")])]),t._v(" "),e("td",[e("code",[t._v("0")])]),t._v(" "),e("td",[t._v("The maximum number of seconds the preflight response may be cached using the "),e("code",[t._v("access-control-max-age")]),t._v(" header. A falsey value will cause the header to not be set.")])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("CORS_METHODS")])]),t._v(" "),e("td",[e("code",[t._v("str")]),t._v(" or "),e("code",[t._v("List[str]")])]),t._v(" "),e("td",[e("code",[t._v('""')])]),t._v(" "),e("td",[t._v("The HTTP methods that the allowed origins can access, as set on the "),e("code",[t._v("access-control-allow-methods")]),t._v(" header.")])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("CORS_ORIGINS")])]),t._v(" "),e("td",[e("code",[t._v("str")]),t._v(", "),e("code",[t._v("List[str]")]),t._v(", "),e("code",[t._v("re.Pattern")])]),t._v(" "),e("td",[e("code",[t._v('"*"')])]),t._v(" "),e("td",[t._v("The origins that are allowed to access the resource, as set on the "),e("code",[t._v("access-control-allow-origin")]),t._v(" header.")])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("CORS_SEND_WILDCARD")])]),t._v(" "),e("td",[e("code",[t._v("bool")])]),t._v(" "),e("td",[e("code",[t._v("False")])]),t._v(" "),e("td",[t._v("If "),e("code",[t._v("True")]),t._v(", will send the wildcard "),e("code",[t._v("*")]),t._v(" origin instead of the "),e("code",[t._v("origin")]),t._v(" request header.")])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("CORS_SUPPORTS_CREDENTIALS")])]),t._v(" "),e("td",[e("code",[t._v("bool")])]),t._v(" "),e("td",[e("code",[t._v("False")])]),t._v(" "),e("td",[t._v("Whether to set the "),e("code",[t._v("access-control-allow-credentials")]),t._v(" header.")])]),t._v(" "),e("tr",[e("td",[e("code",[t._v("CORS_VARY_HEADER")])]),t._v(" "),e("td",[e("code",[t._v("bool")])]),t._v(" "),e("td",[e("code",[t._v("True")])]),t._v(" "),e("td",[t._v("Whether to add "),e("code",[t._v("vary")]),t._v(" header, when appropriate.")])])])]),t._v(" "),e("p",[e("em",[t._v("For the sake of brevity, where the above says "),e("code",[t._v("List[str]")]),t._v(" any instance of a "),e("code",[t._v("list")]),t._v(", "),e("code",[t._v("set")]),t._v(", "),e("code",[t._v("frozenset")]),t._v(", or "),e("code",[t._v("tuple")]),t._v(" will be acceptable. Alternatively, if the value is a "),e("code",[t._v("str")]),t._v(", it can be a comma delimited list.")])]),t._v(" "),e("h2",{attrs:{id:"route-level-overrides"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#route-level-overrides"}},[t._v("#")]),t._v(" Route level overrides")]),t._v(" "),e("div",{staticClass:"multicolumn",staticStyle:{display:"flex","flex-direction":"row","align-items":"flex-start"}},[e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("p",[t._v("It may sometimes be necessary to override app-wide settings for a specific route. To allow for this, you can use the "),e("code",[t._v("@sanic_ext.cors()")]),t._v(" decorator to set different route-specific values.")]),t._v(" "),e("p",[t._v("The values that can be overridden with this decorator are:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("origins")])]),t._v(" "),e("li",[e("code",[t._v("expose_headers")])]),t._v(" "),e("li",[e("code",[t._v("allow_headers")])]),t._v(" "),e("li",[e("code",[t._v("allow_methods")])]),t._v(" "),e("li",[e("code",[t._v("supports_credentials")])]),t._v(" "),e("li",[e("code",[t._v("max_age")])])])]),t._v(" "),e("div",{staticClass:"multicolumn-column",staticStyle:{"flex-grow":"1","flex-basis":"0"}},[e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sanic_ext "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" cors\n\napp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CORS_ORIGINS "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://foo.com"')]),t._v("\n\n\n"),e("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" host"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bar.com"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@cors")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("origins"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://bar.com"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("hello_world")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" text"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, world."')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])])])}),[],!1,null,null,null);e.default=o.exports}}]);